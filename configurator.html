<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cookie Banner Configurator | smallest-cookie-banner</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
    }

    .layout {
      display: grid;
      grid-template-columns: 380px 1fr;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      background: #fff;
      border-right: 1px solid #e0e0e0;
      padding: 20px;
      overflow-y: auto;
      max-height: 100vh;
      position: sticky;
      top: 0;
    }

    .sidebar h1 {
      font-size: 18px;
      margin-bottom: 4px;
    }

    .sidebar .subtitle {
      font-size: 12px;
      color: #666;
      margin-bottom: 20px;
    }

    .section {
      margin-bottom: 24px;
      padding-bottom: 24px;
      border-bottom: 1px solid #eee;
    }

    .section:last-child {
      border-bottom: none;
    }

    .section h2 {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #666;
      margin-bottom: 12px;
    }

    .field {
      margin-bottom: 12px;
    }

    .field label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 4px;
      color: #333;
    }

    .field input[type="text"],
    .field input[type="number"],
    .field select,
    .field textarea {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }

    .field input:focus,
    .field select:focus,
    .field textarea:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .field textarea {
      resize: vertical;
      min-height: 60px;
    }

    .field-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .color-field {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .color-field input[type="color"] {
      width: 36px;
      height: 36px;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 2px;
      cursor: pointer;
    }

    .color-field input[type="text"] {
      flex: 1;
    }

    .checkbox-field {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkbox-field input {
      width: 18px;
      height: 18px;
    }

    .checkbox-field label {
      margin: 0;
      font-weight: normal;
    }

    /* Preview area */
    .preview-area {
      padding: 20px;
      position: relative;
      min-height: 100vh;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .preview-header h2 {
      font-size: 16px;
    }

    .preview-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #2563eb;
      color: #fff;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-secondary {
      background: #fff;
      border: 1px solid #ddd;
      color: #333;
    }

    .btn-secondary:hover {
      background: #f5f5f5;
    }

    /* Code output */
    .code-output {
      margin-top: 20px;
      background: #1e1e1e;
      border-radius: 12px;
      overflow: hidden;
    }

    .code-header {
      background: #2d2d2d;
      padding: 10px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .code-header span {
      color: #888;
      font-size: 13px;
    }

    .code-header button {
      background: #3d3d3d;
      border: none;
      color: #fff;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
    }

    .code-header button:hover {
      background: #4d4d4d;
    }

    .code-body {
      padding: 16px;
      overflow-x: auto;
    }

    .code-body pre {
      margin: 0;
      font-family: 'SF Mono', Monaco, 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
      color: #d4d4d4;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .code-body .comment { color: #6a9955; }
    .code-body .string { color: #ce9178; }
    .code-body .keyword { color: #569cd6; }
    .code-body .property { color: #9cdcfe; }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 0;
      margin-bottom: -1px;
    }

    .tab {
      padding: 8px 16px;
      background: transparent;
      border: none;
      color: #666;
      font-size: 13px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
    }

    .tab.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
    }

    /* Responsive */
    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .sidebar {
        max-height: none;
        position: relative;
      }
      .preview-content {
        height: 400px;
      }
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- Sidebar Controls -->
    <div class="sidebar">
      <h1>Cookie Banner Configurator</h1>
      <p class="subtitle">Customize and generate your code</p>

      <!-- Text Content -->
      <div class="section">
        <h2>Text Content</h2>
        <div class="field">
          <label>Message</label>
          <textarea id="msg">We use cookies to enhance your experience.</textarea>
        </div>
        <div class="field-row">
          <div class="field">
            <label>Accept Button</label>
            <input type="text" id="acceptText" value="Accept">
          </div>
          <div class="field">
            <label>Reject Button</label>
            <input type="text" id="rejectText" value="Decline">
          </div>
        </div>
      </div>

      <!-- Behavior -->
      <div class="section">
        <h2>Behavior</h2>
        <div class="field">
          <label>Mode</label>
          <select id="mode">
            <option value="auto">Auto-detect (EU vs non-EU)</option>
            <option value="eu">Force EU mode (always show reject)</option>
            <option value="non-eu">Force non-EU mode (auto-accept)</option>
          </select>
        </div>
        <div class="field">
          <label>Auto-accept delay (non-EU, ms)</label>
          <input type="number" id="autoAcceptDelay" value="5000" min="0" step="1000">
        </div>
        <div class="field">
          <label>Cookie expiry (days)</label>
          <input type="number" id="days" value="365" min="1">
        </div>
      </div>

      <!-- Position -->
      <div class="section">
        <h2>Position</h2>
        <div class="field">
          <label>Position</label>
          <select id="position">
            <option value="bottom">Bottom (full width)</option>
            <option value="top">Top (full width)</option>
            <option value="bottom-left">Bottom Left (toast)</option>
            <option value="bottom-right">Bottom Right (toast)</option>
            <option value="center">Center (modal)</option>
          </select>
        </div>
      </div>

      <!-- Colors -->
      <div class="section">
        <h2>Colors</h2>
        <div class="field">
          <label>Background</label>
          <div class="color-field">
            <input type="color" id="bgColor" value="#222222">
            <input type="text" id="bgColorText" value="#222222">
          </div>
        </div>
        <div class="field">
          <label>Text Color</label>
          <div class="color-field">
            <input type="color" id="textColor" value="#ffffff">
            <input type="text" id="textColorText" value="#ffffff">
          </div>
        </div>
        <div class="field">
          <label>Accept Button Background</label>
          <div class="color-field">
            <input type="color" id="btnBg" value="#ffffff">
            <input type="text" id="btnBgText" value="#ffffff">
          </div>
        </div>
        <div class="field">
          <label>Accept Button Text</label>
          <div class="color-field">
            <input type="color" id="btnColor" value="#222222">
            <input type="text" id="btnColorText" value="#222222">
          </div>
        </div>
      </div>

      <!-- Typography -->
      <div class="section">
        <h2>Typography</h2>
        <div class="field">
          <label>Font Family</label>
          <select id="fontFamily">
            <option value="system-ui, -apple-system, sans-serif">System (Default)</option>
            <option value="Arial, sans-serif">Arial</option>
            <option value="'Helvetica Neue', Helvetica, sans-serif">Helvetica</option>
            <option value="Georgia, serif">Georgia</option>
            <option value="'Times New Roman', serif">Times New Roman</option>
            <option value="Monaco, 'Courier New', monospace">Monospace</option>
          </select>
        </div>
        <div class="field-row">
          <div class="field">
            <label>Font Size (px)</label>
            <input type="number" id="fontSize" value="14" min="10" max="24">
          </div>
          <div class="field">
            <label>Border Radius (px)</label>
            <input type="number" id="borderRadius" value="0" min="0" max="24">
          </div>
        </div>
        <div class="field-row">
          <div class="field">
            <label>Padding (px)</label>
            <input type="number" id="padding" value="12" min="4" max="32">
          </div>
          <div class="field">
            <label>Button Radius (px)</label>
            <input type="number" id="btnRadius" value="4" min="0" max="24">
          </div>
        </div>
      </div>

      <!-- Advanced -->
      <div class="section">
        <h2>Advanced</h2>
        <div class="field">
          <label>Z-Index</label>
          <input type="number" id="zIndex" value="9999" min="1">
        </div>
        <div class="field">
          <label>Custom CSS (optional)</label>
          <textarea id="customCss" placeholder="#ckb { box-shadow: 0 0 20px rgba(0,0,0,0.2); }"></textarea>
        </div>
      </div>
    </div>

    <!-- Preview Area -->
    <div class="preview-area">
      <div class="preview-header">
        <h2>Generated Code</h2>
        <div class="preview-actions">
          <button class="btn btn-primary" onclick="copyCode()">Copy Code</button>
        </div>
      </div>

      <div class="code-output">
        <div class="code-header">
          <div class="tabs">
            <button class="tab active" onclick="showTab('html')">HTML</button>
            <button class="tab" onclick="showTab('css')">CSS Variables</button>
          </div>
          <button onclick="copyCode()">Copy</button>
        </div>
        <div class="code-body">
          <pre id="code-output"></pre>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Security: Escape functions for different contexts
    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function escapeJs(str) {
      return str
        .replace(/\\/g, '\\\\')
        .replace(/'/g, "\\'")
        .replace(/"/g, '\\"')
        .replace(/\n/g, '\\n')
        .replace(/\r/g, '\\r')
        .replace(/</g, '\\x3C')
        .replace(/>/g, '\\x3E');
    }

    function escapeCss(str) {
      // Remove dangerous CSS patterns
      return str
        .replace(/<[^>]*>/g, '') // Remove HTML tags
        .replace(/@\s*i\s*m\s*p\s*o\s*r\s*t\b[^;]*(;|$)/gi, '') // Remove @import
        .replace(/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\([^)]*\)/gi, '') // Remove expression()
        .replace(/javascript\s*:/gi, '') // Remove javascript:
        .replace(/behavior\s*:[^;]*(;|$)/gi, '') // Remove behavior:
        .replace(/-moz-binding\s*:[^;]*(;|$)/gi, ''); // Remove -moz-binding
    }

    // State
    let currentTab = 'html';

    // Get all input elements
    const inputs = {
      msg: document.getElementById('msg'),
      acceptText: document.getElementById('acceptText'),
      rejectText: document.getElementById('rejectText'),
      mode: document.getElementById('mode'),
      autoAcceptDelay: document.getElementById('autoAcceptDelay'),
      days: document.getElementById('days'),
      position: document.getElementById('position'),
      bgColor: document.getElementById('bgColor'),
      bgColorText: document.getElementById('bgColorText'),
      textColor: document.getElementById('textColor'),
      textColorText: document.getElementById('textColorText'),
      btnBg: document.getElementById('btnBg'),
      btnBgText: document.getElementById('btnBgText'),
      btnColor: document.getElementById('btnColor'),
      btnColorText: document.getElementById('btnColorText'),
      fontFamily: document.getElementById('fontFamily'),
      fontSize: document.getElementById('fontSize'),
      borderRadius: document.getElementById('borderRadius'),
      padding: document.getElementById('padding'),
      btnRadius: document.getElementById('btnRadius'),
      zIndex: document.getElementById('zIndex'),
      customCss: document.getElementById('customCss'),
    };

    // Sync color inputs
    ['bg', 'text', 'btnBg', 'btnColor'].forEach(prefix => {
      const colorInput = inputs[prefix + 'Color'];
      const textInput = inputs[prefix + 'ColorText'];

      colorInput.addEventListener('input', () => {
        textInput.value = colorInput.value;
        updatePreview();
      });

      textInput.addEventListener('input', () => {
        if (/^#[0-9a-f]{6}$/i.test(textInput.value)) {
          colorInput.value = textInput.value;
        }
        updatePreview();
      });
    });

    // Add event listeners to all inputs
    Object.values(inputs).forEach(input => {
      input.addEventListener('input', updatePreview);
      input.addEventListener('change', updatePreview);
    });

    // Get current config
    function getConfig() {
      return {
        msg: inputs.msg.value,
        acceptText: inputs.acceptText.value,
        rejectText: inputs.rejectText.value,
        mode: inputs.mode.value,
        autoAcceptDelay: parseInt(inputs.autoAcceptDelay.value),
        days: parseInt(inputs.days.value),
        position: inputs.position.value,
        bgColor: inputs.bgColorText.value,
        textColor: inputs.textColorText.value,
        btnBg: inputs.btnBgText.value,
        btnColor: inputs.btnColorText.value,
        fontFamily: inputs.fontFamily.value,
        fontSize: parseInt(inputs.fontSize.value),
        borderRadius: parseInt(inputs.borderRadius.value),
        padding: parseInt(inputs.padding.value),
        btnRadius: parseInt(inputs.btnRadius.value),
        zIndex: parseInt(inputs.zIndex.value),
        customCss: inputs.customCss.value,
      };
    }

    // Generate position CSS
    function getPositionCSS(position) {
      const positions = {
        'bottom': '',
        'top': '--ckb-bottom: auto; --ckb-top: 0;',
        'bottom-left': '--ckb-right: auto; --ckb-left: 20px; --ckb-bottom: 20px;',
        'bottom-right': '--ckb-left: auto; --ckb-right: 20px; --ckb-bottom: 20px;',
        'center': '--ckb-bottom: auto; --ckb-top: 50%; --ckb-left: 50%; --ckb-right: auto;',
      };
      return positions[position] || '';
    }

    // Generate output code
    function generateOutputCode(config) {
      const forceEU = config.mode === 'eu' ? 'true' : config.mode === 'non-eu' ? 'false' : null;

      let positionVars = getPositionCSS(config.position);
      let extraCSS = '';

      if (config.position === 'bottom-left' || config.position === 'bottom-right') {
        extraCSS = `
#ckb {
  width: 340px;
  border-radius: ${config.borderRadius}px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  flex-direction: column;
}
#ckb p { min-width: auto; margin-bottom: 10px; }`;
      }

      if (config.position === 'center') {
        extraCSS = `
#ckb {
  width: 400px;
  border-radius: ${config.borderRadius}px;
  box-shadow: 0 4px 40px rgba(0,0,0,0.3);
  flex-direction: column;
  text-align: center;
  transform: translate(-50%, -50%);
}
#ckb p { min-width: auto; margin-bottom: 12px; }`;
      }

      if (currentTab === 'css') {
        // Sanitize values for CSS tab
        const cssBgColor = escapeHtml(config.bgColor);
        const cssTextColor = escapeHtml(config.textColor);
        const cssBtnBg = escapeHtml(config.btnBg);
        const cssBtnColor = escapeHtml(config.btnColor);
        const cssFontFamily = escapeHtml(config.fontFamily);
        const cssCustomCss = escapeCss(config.customCss);

        return `<span class="comment">/* Add to your CSS */</span>
<span class="keyword">:root</span> {
  <span class="property">--ckb-bg</span>: <span class="string">${cssBgColor}</span>;
  <span class="property">--ckb-color</span>: <span class="string">${cssTextColor}</span>;
  <span class="property">--ckb-btn-bg</span>: <span class="string">${cssBtnBg}</span>;
  <span class="property">--ckb-btn-color</span>: <span class="string">${cssBtnColor}</span>;
  <span class="property">--ckb-font</span>: <span class="string">${parseInt(config.fontSize)}px ${cssFontFamily}</span>;
  <span class="property">--ckb-padding</span>: <span class="string">${parseInt(config.padding)}px 16px</span>;
  <span class="property">--ckb-btn-radius</span>: <span class="string">${parseInt(config.btnRadius)}px</span>;
  <span class="property">--ckb-z</span>: <span class="string">${parseInt(config.zIndex)}</span>;${positionVars ? '\n  ' + positionVars.split(';').filter(s => s.trim()).join(';\n  ') + ';' : ''}
}${extraCSS}${cssCustomCss ? '\n\n' + cssCustomCss : ''}`;
      }

      // HTML tab - use proper escaping for all user inputs
      let configObj = [];
      if (config.msg !== 'We use cookies to enhance your experience.') {
        configObj.push(`  msg: '${escapeJs(config.msg)}'`);
      }
      if (config.acceptText !== 'Accept') {
        configObj.push(`  acceptText: '${escapeJs(config.acceptText)}'`);
      }
      if (config.rejectText !== 'Decline') {
        configObj.push(`  rejectText: '${escapeJs(config.rejectText)}'`);
      }
      if (forceEU !== null) {
        configObj.push(`  forceEU: ${forceEU}`);
      }
      if (config.autoAcceptDelay !== 5000) {
        configObj.push(`  autoAcceptDelay: ${config.autoAcceptDelay}`);
      }
      if (config.days !== 365) {
        configObj.push(`  days: ${config.days}`);
      }

      // Sanitize CSS values for output
      const safeBgColor = escapeHtml(config.bgColor);
      const safeTextColor = escapeHtml(config.textColor);
      const safeBtnBg = escapeHtml(config.btnBg);
      const safeBtnColor = escapeHtml(config.btnColor);
      const safeFontFamily = escapeHtml(config.fontFamily);
      const safeCustomCss = escapeCss(config.customCss);

      let cssVars = `  --ckb-bg: ${safeBgColor};
  --ckb-color: ${safeTextColor};
  --ckb-btn-bg: ${safeBtnBg};
  --ckb-btn-color: ${safeBtnColor};
  --ckb-font: ${parseInt(config.fontSize)}px ${safeFontFamily};
  --ckb-padding: ${parseInt(config.padding)}px 16px;
  --ckb-btn-radius: ${parseInt(config.btnRadius)}px;
  --ckb-z: ${parseInt(config.zIndex)};${positionVars ? '\n  ' + positionVars.split(';').filter(s => s.trim()).join(';\n  ') + ';' : ''}`;

      return `<span class="comment">&lt;!-- Add to &lt;head&gt; --&gt;</span>
<span class="keyword">&lt;style&gt;</span>
:root {
${cssVars}
}${extraCSS}${safeCustomCss ? '\n' + safeCustomCss : ''}
<span class="keyword">&lt;/style&gt;</span>

<span class="comment">&lt;!-- Add before &lt;/body&gt; --&gt;</span>
${configObj.length > 0 ? `<span class="keyword">&lt;script&gt;</span>
window.CookieBannerConfig = {
${configObj.join(',\n')},
  onYes: function() { <span class="comment">/* Load analytics */</span> },
  onNo: function() { <span class="comment">/* Respect choice */</span> }
};
<span class="keyword">&lt;/script&gt;</span>
` : ''}<span class="keyword">&lt;script</span> <span class="property">src</span>=<span class="string">"https://unpkg.com/smallest-cookie-banner@latest/dist/cookie-banner.min.js"</span><span class="keyword">&gt;&lt;/script&gt;</span>`;
    }

    // Update code output
    function updatePreview() {
      const config = getConfig();
      document.getElementById('code-output').innerHTML = generateOutputCode(config);
    }

    // Show tab
    function showTab(tab) {
      currentTab = tab;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`.tab[onclick="showTab('${tab}')"]`).classList.add('active');
      document.getElementById('code-output').innerHTML = generateOutputCode(getConfig());
    }

    // Copy code with fallback
    function copyCode() {
      const config = getConfig();
      let code = generateOutputCode(config)
        .replace(/<span class="[^"]*">/g, '')
        .replace(/<\/span>/g, '')
        .replace(/&lt;/g, '<')
        .replace(/&gt;/g, '>');

      const showSuccess = () => {
        const btn = document.querySelector('.code-header button');
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = 'Copy', 2000);
      };

      // Try modern clipboard API first, fallback to execCommand
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(code).then(showSuccess).catch(() => {
          // Fallback for older browsers or non-HTTPS
          fallbackCopy(code, showSuccess);
        });
      } else {
        fallbackCopy(code, showSuccess);
      }
    }

    function fallbackCopy(text, onSuccess) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      try {
        document.execCommand('copy');
        onSuccess();
      } catch (err) {
        console.error('Copy failed:', err);
      }
      document.body.removeChild(textarea);
    }

    // Initial render
    updatePreview();
  </script>
</body>
</html>
